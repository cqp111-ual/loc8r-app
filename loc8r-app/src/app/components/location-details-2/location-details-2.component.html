<ion-content #content fullscreen class="location-details-content" scrollEvents="true">

  <ion-loading
    [isOpen]="isLoading"
    duration="1000"
    spinner="circles"
    message="Cargando ubicación..."
  ></ion-loading>

  <ion-toast
    [isOpen]="showError"
    message="No se pudo cargar la ubicación."
    duration="3000"
    color="danger"
    (ionDidDismiss)="showError = false"
  ></ion-toast>
 
  <!-- Imagen destacada -->
  <div class="image-container">
    <ion-img [src]="location.imageUrl" class="header-image" alt="{{ location.name }}"></ion-img>

    <!-- Botón moderno para ver imagen -->
    <ion-button fill="clear" class="image-viewer-button" (click)="showImage = true">
      <ion-icon name="scan-circle-outline"></ion-icon>
    </ion-button>

    <!-- Componente visualizador de imagen -->
    <app-image-visualizer
      *ngIf="showImage"
      [imageUrl]="location.imageUrl"
      (close)="showImage = false"
    ></app-image-visualizer>
  </div>

  <div class="content-wrapper">

    <!-- Información general -->
    <div class="location-summary">
      <h1 class="location-name">{{ location.name }}</h1>
      <p class="location-address">{{ location.address }}</p>

      <div class="rating-summary">
        <div class="rating-score" [ngClass]="ratingClass">{{ ratingDecimal }}</div>
        <div class="rating-details">
          <div class="rating-message"><strong>{{ ratingMessage }}</strong></div>
          <div class="reviews-count">{{ location.numReviews }} reseñas</div>
        </div>
      </div>
    </div>

    <!-- Mapa integrado -->
    <div class="map-section">
      <h2>Ubicación en el mapa</h2>
      <div class="map-container">
        <iframe
          [src]="googleMapsEmbedUrl"
          frameborder="0"
          allowfullscreen
          loading="lazy"
        ></iframe>
      </div>
    </div>

    <!-- Información adicional -->
    <div class="more-info-section">
      <h2>Más información</h2>
      <p>Aquí puedes poner descripciones, imágenes adicionales, horarios, teléfono, etc.</p>
    </div>

    <!-- Reseñas -->
    <div class="reviews-section">
      <h2>Reseñas</h2>
    
      <!-- Spinner inicial mientras carga -->
      <div *ngIf="reviewsLoading && reviews.length === 0" class="spinner-container">
        <ion-spinner name="crescent" color="primary"></ion-spinner>
        <p>Cargando reseñas...</p>
      </div>
    
      <!-- Lista de reseñas -->
      <div *ngIf="reviews.length > 0" class="reviews-list">
        <app-review-card
        *ngFor="let review of reviews"
        [review]="review"
        class="review-card ion-margin-vertical" 
      ></app-review-card>
      </div>
    
      <!-- Mensaje si no hay reseñas y no se está cargando -->
      <ion-item *ngIf="!reviewsLoading && reviews.length === 0" lines="none">
        <ion-label>No hay reseñas disponibles.</ion-label>
      </ion-item>
    
      <!-- Scroll infinito (oculto si ya se cargaron todas) -->
      <ion-infinite-scroll
        threshold="20px"
        (ionInfinite)="loadMoreReviews($event)"
        [disabled]="reviewsFinished || reviewsLoading">
        <ion-infinite-scroll-content
          loadingSpinner="crescent"
          loadingText="Cargando más reseñas...">
        </ion-infinite-scroll-content>
      </ion-infinite-scroll>
    </div>
  </div>
</ion-content>
